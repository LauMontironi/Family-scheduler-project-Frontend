<section class="page" [class.blurred]="selectedMember()">

    <header class="page-header">
        <div class="headline">
            <span class="chip">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Dashboard</span>
            <h1 class="title">Mi familia</h1>
            <p class="subtitle">Gesti√≥n centralizada de miembros, ni√±os y agenda.</p>
        </div>

        <div class="header-actions">
            <button class="btn ghost me-2" (click)="goAddMember()">
                + A√±adir Integrante
            </button>
            <button class="btn primary" (click)="goEvents()">Ir a Eventos</button>
        </div>
    </header>

    <!-- ADULTOS -->
    <section class="panel">
        <div class="panel-head">
            <h2 class="panel-title">Miembros Adultos</h2>
            <span class="count-pill">Total: {{ adultsList().length }}</span>
        </div>

        <div class="grid grid-4">
            @for (m of adultsList(); track $index) {
            <article class="card hover-card" (click)="openMember(m)">
                <div class="card-overlay-actions">
                    <button class="mini-btn" (click)="$event.stopPropagation(); openMember(m)">Ver</button>
                    <button class="mini-btn dark" (click)="$event.stopPropagation(); goUpdateMember(m)">Update</button>
                </div>

                <div class="card-row">
                    <img class="avatar xl" [src]="avatarForMember(m)" />
                    <div class="text">
                        <h3 class="card-title">{{ m.full_name }}</h3>
                        <span class="role-pill">{{ m.relationship }}</span>
                    </div>
                </div>
            </article>
            }
        </div>
    </section>

    <!-- NI√ëOS -->
    <section class="panel">
        <div class="panel-head">
            <h2 class="panel-title">Ni√±os</h2>
            <span class="count-pill">Total: {{ children().length }}</span>
        </div>

        <div class="grid grid-3">
            @for (c of children(); track $index) {
            <article class="card hover-card" (click)="openMember(c)">
                <div class="card-overlay-actions">
                    <button class="mini-btn" (click)="$event.stopPropagation(); openMember(c)">Ver</button>
                    <button class="mini-btn dark" (click)="$event.stopPropagation(); goUpdateMember(c)">Update</button>
                </div>

                <div class="card-row">
                    <img class="avatar xl" [src]="avatarForMember(c)" />
                    <div class="text">
                        <h3 class="card-title">{{ c.full_name }}</h3>
                        <p class="card-muted">Nacimiento: {{ c.birthdate || 'No definida' }}</p>
                    </div>
                </div>

                <div class="card-footer">
                    <button class="btn tiny primary">Ver Agenda</button>
                </div>
            </article>
            }
        </div>
    </section>

</section>


@if (selectedMember()) {
<div class="modal-backdrop" (click)="closeMember()">
    <div class="modal-card" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2 style="margin:0;">Detalle del miembro</h2>
            <button class="mini-btn" (click)="closeMember()">Cerrar</button>
        </div>

        <div class="modal-body">
            <img class="modal-avatar" [src]="avatarForMember(selectedMember())" />

            <h3 style="margin:8px 0 0 0;">{{ selectedMember().full_name }}</h3>
            <p style="margin:0; font-weight:700; opacity:.8;">
                {{ selectedMember().is_child ? 'Ni√±o/a' : 'Adulto' }} ¬∑ {{ selectedMember().relationship || '-' }}
            </p>

            <div class="modal-grid">
                <div><b>Cumple:</b> {{ selectedMember().birthdate || '-' }}</div>
                <div><b>G√©nero:</b> {{ selectedMember().gender || '-' }}</div>
                <div><b>Ciudad:</b> {{ selectedMember().city || '-' }}</div>
                <div><b>Hobbys:</b> {{ selectedMember().hobbys || '-' }}</div>
                <div><b>Admin:</b> {{ selectedMember().is_admin }}</div>
            </div>

            <div style="display:flex; gap:10px; margin-top:14px;">
                <button class="mini-btn dark" (click)="goUpdateMember(selectedMember())">Update</button>
                <button class="mini-btn" (click)="closeMember()">OK</button>
            </div>
        </div>
    </div>
</div>
}